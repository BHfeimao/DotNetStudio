<?xml version="1.0"?>
<dataOperations>
    <dataCommand name="GetUsers" connectionStringName="SqlServerData" commandType="Text">
        <commandText>
            <![CDATA[
select * FROM dbo.[User]
		]]>
        </commandText>
        
    </dataCommand>

  <dataCommand name="GetUserByUserId" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
select * FROM dbo.[User] where Id=@UserId;
		]]>
    </commandText>
    <parameters>
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetUserByName" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
select * FROM dbo.[User] where Mobile=@Mobile;
		]]>
    </commandText>
    <parameters>
      <param name="@Mobile" dbType="String" direction="Input" size="25" />
    </parameters>
  </dataCommand>
  <dataCommand name="GetUserByWxOpenId" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
select * FROM dbo.[User] where WxOpenId=@WxOpenId;
		]]>
    </commandText>
    <parameters>
      <param name="@WxOpenId" dbType="String" direction="Input" size="50" />
    </parameters>
  </dataCommand>
  <dataCommand name="InsertUser" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [dbo].[User]
           ([Mobile]
           ,[WxOpenId]
           ,[WxNickName]
           ,[WxSex]
           ,[WxHeadUrl]
           ,[WxSubTime]
           ,[WxUnionId]
           ,[WxRemark]
           ,[WxGroupId]
           ,[Status]
           ,[CreateTime])
     VALUES
           (@Mobile
           ,@WxOpenId
           ,@WxNickName
           ,@WxSex
           ,@WxHeadUrl
           ,@WxSubTime
           ,@WxUnionId
           ,@WxRemark
           ,@WxGroupId
           ,@Status
           ,@CreateTime);
           select @@identity;
		]]>
    </commandText>
    <parameters>
      <param name="@Mobile" dbType="String" direction="Input" size="25" />
      <param name="@WxOpenId" dbType="String" direction="Input" size="50" />
      <param name="@WxNickName" dbType="String" direction="Input" size="30" />
      <param name="@WxSex" dbType="Int32" direction="Input" size="4" />
      <param name="@WxHeadUrl" dbType="String" direction="Input" size="500" />
      <param name="@WxSubTime" dbType="String" direction="Input" size="15" />
      <param name="@WxUnionId" dbType="String" direction="Input" size="50" />
      <param name="@WxRemark" dbType="String" direction="Input" size="30" />
      <param name="@WxGroupId" dbType="Int32" direction="Input" size="4" />
      <param name="@Status" dbType="Int32" direction="Input" size="4" />
      <param name="@CreateTime" dbType="DateTime" direction="Input" size="8" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetUserByPageList" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
with DataSource
as
(
select * from dbo.[User](NOLOCK)
),
PageDataSource
as 
(
select row_number() over (Order by CreateTime desc) as RowsId,*
from DataSource
)
select * from PageDataSource
where RowsId between (@PageIndex-1)*@PageSize and @PageIndex*@PageSize;
SELECT COUNT(1) FROM dbo.[User](NOLOCK)
]]>
    </commandText>
    <parameters>
      <param name="@PageIndex" dbType="Int32" direction="Input" size="4" />
      <param name="@PageSize" dbType="Int32" direction="Input" size="4" />
    </parameters>
  </dataCommand>
  
  <dataCommand name="UpdateUserStatus" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE [dbo].[User]
   SET [Status] = @Status
 WHERE Id=@UserId
		]]>
    </commandText>
    <parameters>
      <param name="@Status" dbType="Int32" direction="Input" size="4" />
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
    </parameters>
  </dataCommand>

  <dataCommand name="GetUnUsedCaptcha" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
  select Captcha from UserCaptcha(nolock) where UserId=@UserId and [Status]=0;
		]]>
    </commandText>
    <parameters>
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
      <param name="@Mobile" dbType="String" direction="Input" size="11" />
    </parameters>
  </dataCommand>

  <dataCommand name="InsertUserCaptcha" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
INSERT INTO [dbo].[UserCaptcha]
           ([UserId]
           ,[Captcha]
           ,[SendTime]
           ,[Status])
     VALUES
           (@UserId
           ,@Captcha
           ,@SendTime
           ,@Status)
		]]>
    </commandText>
    <parameters>
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
      <param name="@Captcha" dbType="Int32" direction="Input" size="4" />
      <param name="@SendTime" dbType="DateTime" direction="Input" size="8" />
      <param name="@Status" dbType="Int32" direction="Input" size="4" />
    </parameters>
  </dataCommand>

  <dataCommand name="updateMobileByWxOpenId" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
UPDATE [dbo].[User]
   SET [Mobile] = @Mobile
 WHERE WxOpenId=@WxOpenId
		]]>
    </commandText>
    <parameters>
      <param name="@Mobile" dbType="String" direction="Input" size="25" />
      <param name="@WxOpenId" dbType="String" direction="Input" size="50" />
    </parameters>
  </dataCommand>

  <dataCommand name="CheckMobileCaptcha" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
SELECT TOP 1 
 [Captcha]
  FROM [dbo].[UserCaptcha] where [Status]=0  --and DATEDIFF(n,SendTime,GETDATE())<5
  and UserId=@UserId
		]]>
    </commandText>
    <parameters>
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
      <param name="@WxOpenId" dbType="String" direction="Input" size="50" />
    </parameters>
  </dataCommand>

  <dataCommand name="UpdateUserCaptchaStatus" connectionStringName="SqlServerData" commandType="Text">
    <commandText>
      <![CDATA[
update [dbo].[UserCaptcha] set Status=1 where [Status]=0  and UserId=@UserId
		]]>
    </commandText>
    <parameters>
      <param name="@UserId" dbType="Int32" direction="Input" size="4" />
    </parameters>
  </dataCommand>

  

</dataOperations>
